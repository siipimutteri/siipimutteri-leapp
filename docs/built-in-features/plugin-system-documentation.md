#Plugin System

Leapp now integrates a new plugin system! 

You can now write your own plugins and/or import custom ones created by the community. This allows you to extend what Leapp can do by adding customizable and quick actions that can be run with
Leapp-generated temporary credentials.

##How to write a plugin

This section will provide an explanation of the plugin system and a quick starting guide in case you want to start developing you own plugins, followed by a tutorial example that you can use as a starting point.

##Plugin structure

Leapp plugins are written in TypeScript. They consist of custom classes that extend a base class provided by the plugin sdk and that can be loaded into Leapp at runtime to add additional features to Leapp.

By using Webpack, you are able to install and use any npm packages you want to extend Leapp functionalities. Our template script will bundle all the dependencies into one single `plugin.js` file which represents your entire plugin.

A ready-to-use Leapp plugin is comprised of two main files: a `package.json` file and a `plugin.js` file.

The `package.json` file contains metadata about the plugin. See [next section](/built-in-features/plugin-system-documentation/#plugin-packagejson-metadata) for a description of every available property that can be specified.

###AwsCredentialsPlugin

In order to be recognized as a Leapp plugin, your TypeScript class must extend a base abstract class available in Leapp core called `AwsCredentialsPlugin`.

From this class, you need to implement both getters for actionName and actionIcon:

- `actionIcon` must return a string containing a FontAwesome complete code (e.g. "fa fa-globe"). [See here](https://fontawesome.com/v5/search) for all available icons.
- `actionName` must return a string which will be the name of the action that you will see in the contextual menu (e.g. "Open Web Console")

`applySessionAction` is invoked when the user clicks on the contextual menu voice and contains the main logic used by the plugin.
When you implement this method, you have access to the following arguments:

- the [Session object](https://github.com/Noovolari/leapp/blob/master/packages/core/src/models/session.ts) which in this case represents the Leapp session the user clicked on (for Leapp CLI, the session selected in the wizard or specified with a flag)
- a set of temporary credentials, generated by Leapp for that session

A class that extends `AwsCredentialsPlugin` can access a property called `pluginEnvironment`. This property is an instance of a [wrapper class](https://github.com/Noovolari/leapp/blob/master/packages/core/src/plugin-sdk/plugin-environment.ts) which collects methods that Leapp offers to the developer of a plugin.

Right now, these methods are:

- **`log`**`(message: string, level: PluginLogLevel, display: boolean): void`

  Log a custom message in Leapp or in the log file

  | argument          | type |  description |
  | -------------------------- | --------- | --------|
  | message   | string     | the message to show  |
  | level    | [LogLevel](https://github.com/Noovolari/leapp/blob/master/packages/core/src/plugin-sdk/plugin-log-level.ts)   | severity of the message   |
  | display    | boolean     | shows the message in a toast in the desktop app when true. Otherwise, log it in the log files   |

- **`fetch`**`(url: string): any`

  Retrieve the content of an URL. Returns a promise for the URL

  | argument          | type |  description |
  | -------------------------- | --------- | --------|
  | url   | string     | a valid HTTP URL to fetch from |


- **`openExternalUrl`**`(url: string): void`

  Open an external URL in the default browser

  | argument          | type |  description |
  | -------------------------- | --------- | --------|
  | url   | string     | a valid HTTP URL to open in the default browser |


##Plugin package.json metadata

The Leapp Plugin Template comes with an already constructed `package.json`. You can change the values contained there to match your project.
Here's a description of the available properties:

| property          | values |  description | constraints |
| -------------------------- | --------- | --------| ----- |
| name   | a custom string     | the name of the plugin | the same used in the plugin folder |
| author   | a custom string     | the name of the author | none |
| version   | a custom string     | the version of the plugin | must be a semver string |
| description   | a custom string     | the description of the plugin | none |
| keywords   | a string array     | the name of the plugin | must contain at least "leapp-plugin" |
| leappPlugin   | an object     | the plugin custom configuration | must contain at least "supportedOS" and "supportedSessions" |
| leappPlugin.supportedOS   | a string array     | ["mac", "windows", "linux"] | if not specified, all OSs will be considered compatible |
| leappPlugin.supportedSessions   | a string array         | ["anyType, "aws", "azure", "awsIamRoleFederated", "awsIamRoleChained", "awsSsoRole", "awsIamUser"] | at least one of these values must be specified |


##Starting template

You can start developing your own plugin from the template [available here](https://github.com/Noovolari/leapp-plugin-template).

This template is a TypeScript project already set with Webpack as a dependency bundler, allowing you to add any external library that you want in your project.

`webpack-config.js` and `ts-config.json` should not be edited.

Simply clone the repository and run `npm install` (you must have Node >= 16.14.0).

From here you can start developing. You can edit the `package.json` file to suit your needs and edit the class that extends `AwsCredentialsPlugin`. You can also add any additional npm package that you need. Thanks to the Webpack system, every dependency will be bundled in the final plugin.js output file. 

Finally, to create the plugin.js file, run `npm run build`.

To debug your plugin, refer to the [manual installation section](/built-in-features/plugin-system-usage/#install-manually) of this documentation.

##How to publish

If you want, you can publish your plugin on npm to make it available to everyone.

As a prerequisite, you need to be registered on [npmjs.com](https://www.npmjs.com/).

On your terminal, go to the root directory of your plugin project (where the plugin `package.json` is located)

Run `npm login` and insert your username and password.

Once logged in to npm, you must have defined a package.json version which is >= of the plugin version published on npm (if you already published a npm package with that name).

Finally, run `npm publish --access public`

